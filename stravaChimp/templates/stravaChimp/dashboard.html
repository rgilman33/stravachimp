<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  position: relative;
  width: 960px;
}

.highlight {fill:black}
#tooltip, #tooltip2 {
			position: absolute;
			top: 0;
			left: 0;
			z-index: 10;
			margin: 0;
			padding: 10px;
			width: 15px;
			height: 12px;
			color: black;
			font-family: sans-serif;
			font-size: 12px;
			font-weight: bold;
			text-align: center;
			background-color: rgba(0, 0, 0, 0.0);
			opacity: 0;
			pointer-events: none;
		}

text {
  font: 10px sans-serif;
}

.kill {opacity: 0}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.tick line{
    opacity: 0.1;
  }

form {
  position: absolute;
  right: 10px;
  top: 10px;
}


.day {
  fill: #fff;
  stroke: #ccc;
}

.month {
  fill: none;
  stroke: #000;
  stroke-width: 2px;
}


</style>
</head>

<body>

<h1><a href="{% url 'run_detail' pk=466777343 %}">run 466777343</a></h1>

<div id="tooltip">
</div>

<div id="calendar"> 
</div>

<div id="roll"> 
</div>

<div id="bars"> 
<form>
  <label><input type="radio" name="mode" value="grouped"> Grouped</label>
  <label><input type="radio" name="mode" value="stacked" checked> Stacked</label>
</form>
</div>

<div id="buttonContainer">
	<button id="reset">All</button>
</div>

<div id="buttonContainer">
	<button id="month">Last 30 days</button>
</div>

</body>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
/*
var recovery = 
{"0":{"x":1441497600000,"y":2482.6},"1":{"x":1441670400000,"y":1068.4},"2":{"x":1441756800000,"y":3526.0},"3":{"x":1441843200000,"y":87.8},"4":{"x":1441843200000,"y":1856.2},"5":{"x":1442188800000,"y":2173.8},"6":{"x":1442534400000,"y":3013.8},"7":{"x":1442620800000,"y":0.0},"8":{"x":1442707200000,"y":0.0},"9":{"x":1444003200000,"y":881.2},"10":{"x":1444176000000,"y":743.8},"11":{"x":1444262400000,"y":1343.4},"12":{"x":1444521600000,"y":2519.6},"13":{"x":1444608000000,"y":871.8},"14":{"x":1444953600000,"y":3092.4},"15":{"x":1445040000000,"y":3635.6},"16":{"x":1445212800000,"y":2462.2},"17":{"x":1445472000000,"y":1718.0},"18":{"x":1445558400000,"y":7298.4},"19":{"x":1445731200000,"y":4154.6},"20":{"x":1445817600000,"y":1328.0},"21":{"x":1446249600000,"y":1935.8},"22":{"x":1446336000000,"y":8711.6},"23":{"x":1446422400000,"y":851.6},"24":{"x":1446422400000,"y":1190.4},"25":{"x":1446595200000,"y":1652.6},"26":{"x":1446681600000,"y":5397.0},"27":{"x":1446940800000,"y":5484.0},"28":{"x":1447200000000,"y":4943.4},"29":{"x":1447545600000,"y":3344.6},"30":{"x":1447718400000,"y":9429.8},"31":{"x":1447977600000,"y":3360.2},"32":{"x":1448064000000,"y":2089.8},"33":{"x":1449100800000,"y":3564.0},"34":{"x":1449619200000,"y":3178.2},"35":{"x":1449705600000,"y":3828.8},"36":{"x":1449878400000,"y":1816.2},"37":{"x":1449964800000,"y":277.8},"38":{"x":1450137600000,"y":2559.8},"39":{"x":1450483200000,"y":4319.0},"40":{"x":1450569600000,"y":4706.8},"41":{"x":1452297600000,"y":3221.8}};

var easy = {"0":{"x":1441497600000,"y":17694.4},"1":{"x":1441670400000,"y":7596.4},"2":{"x":1441756800000,"y":29154.4},"3":{"x":1441843200000,"y":0.0},"4":{"x":1441843200000,"y":7686.8},"5":{"x":1442188800000,"y":24877.5999999999},"6":{"x":1442534400000,"y":11976.2},"7":{"x":1442620800000,"y":0.0},"8":{"x":1442707200000,"y":0.0},"9":{"x":1444003200000,"y":1430.2},"10":{"x":1444176000000,"y":2129.4},"11":{"x":1444262400000,"y":5560.0},"12":{"x":1444521600000,"y":3673.6},"13":{"x":1444608000000,"y":7126.0},"14":{"x":1444953600000,"y":4296.6},"15":{"x":1445040000000,"y":3718.6},"16":{"x":1445212800000,"y":4994.2},"17":{"x":1445472000000,"y":12265.0},"18":{"x":1445558400000,"y":11848.0},"19":{"x":1445731200000,"y":2401.8},"20":{"x":1445817600000,"y":5798.4},"21":{"x":1446249600000,"y":8499.8},"22":{"x":1446336000000,"y":7040.2},"23":{"x":1446422400000,"y":779.6},"24":{"x":1446422400000,"y":13017.4},"25":{"x":1446595200000,"y":17239.8},"26":{"x":1446681600000,"y":11395.6},"27":{"x":1446940800000,"y":9758.4},"28":{"x":1447200000000,"y":10568.6},"29":{"x":1447545600000,"y":9763.6},"30":{"x":1447718400000,"y":4436.2},"31":{"x":1447977600000,"y":6993.0},"32":{"x":1448064000000,"y":12321.6},"33":{"x":1449100800000,"y":5621.6},"34":{"x":1449619200000,"y":13183.0},"35":{"x":1449705600000,"y":8033.2},"36":{"x":1449878400000,"y":8669.6},"37":{"x":1449964800000,"y":957.6},"38":{"x":1450137600000,"y":8286.8},"39":{"x":1450483200000,"y":16105.6},"40":{"x":1450569600000,"y":7277.6},"41":{"x":1452297600000,"y":13768.2}}

var stamina =
{"0":{"x":1441497600000,"y":16486.2},"1":{"x":1441670400000,"y":7866.2},"2":{"x":1441756800000,"y":8247.2},"3":{"x":1441843200000,"y":0.0},"4":{"x":1441843200000,"y":4747.4},"5":{"x":1442188800000,"y":7387.2},"6":{"x":1442534400000,"y":19890.8000000001},"7":{"x":1442620800000,"y":0.0},"8":{"x":1442707200000,"y":0.0},"9":{"x":1444003200000,"y":13546.2},"10":{"x":1444176000000,"y":7074.4},"11":{"x":1444262400000,"y":13593.4},"12":{"x":1444521600000,"y":11760.8},"13":{"x":1444608000000,"y":3942.0},"14":{"x":1444953600000,"y":15057.6},"15":{"x":1445040000000,"y":2554.4},"16":{"x":1445212800000,"y":10118.6},"17":{"x":1445472000000,"y":8091.4},"18":{"x":1445558400000,"y":8479.8},"19":{"x":1445731200000,"y":3765.6},"20":{"x":1445817600000,"y":15538.6},"21":{"x":1446249600000,"y":6481.8},"22":{"x":1446336000000,"y":927.0},"23":{"x":1446422400000,"y":961.4},"24":{"x":1446422400000,"y":6505.2},"25":{"x":1446595200000,"y":4427.8},"26":{"x":1446681600000,"y":7066.4},"27":{"x":1446940800000,"y":3169.0},"28":{"x":1447200000000,"y":6170.8},"29":{"x":1447545600000,"y":8534.2},"30":{"x":1447718400000,"y":6429.4},"31":{"x":1447977600000,"y":7782.0},"32":{"x":1448064000000,"y":4402.4},"33":{"x":1449100800000,"y":12544.8},"34":{"x":1449619200000,"y":5493.8},"35":{"x":1449705600000,"y":3092.6},"36":{"x":1449878400000,"y":8016.8},"37":{"x":1449964800000,"y":1510.6},"38":{"x":1450137600000,"y":8075.6},"39":{"x":1450483200000,"y":1668.4},"40":{"x":1450569600000,"y":444.8},"41":{"x":1452297600000,"y":2864.2}}

var impulse = 
{"0":{"x":1441497600000,"y":2174.0},"1":{"x":1441670400000,"y":6053.6},"2":{"x":1441756800000,"y":764.4},"3":{"x":1441843200000,"y":0.0},"4":{"x":1441843200000,"y":3778.4},"5":{"x":1442188800000,"y":365.6},"6":{"x":1442534400000,"y":6366.0},"7":{"x":1442620800000,"y":0.0},"8":{"x":1442707200000,"y":0.0},"9":{"x":1444003200000,"y":7978.8},"10":{"x":1444176000000,"y":7995.2},"11":{"x":1444262400000,"y":2722.6},"12":{"x":1444521600000,"y":5210.8},"13":{"x":1444608000000,"y":69.6},"14":{"x":1444953600000,"y":3307.8},"15":{"x":1445040000000,"y":4551.4},"16":{"x":1445212800000,"y":11141.6},"17":{"x":1445472000000,"y":246.6},"18":{"x":1445558400000,"y":92.2},"19":{"x":1445731200000,"y":10011.0},"20":{"x":1445817600000,"y":224.8},"21":{"x":1446249600000,"y":4161.0},"22":{"x":1446336000000,"y":0.0},"23":{"x":1446422400000,"y":3105.6},"24":{"x":1446422400000,"y":1764.4},"25":{"x":1446595200000,"y":0.0},"26":{"x":1446681600000,"y":4102.4},"27":{"x":1446940800000,"y":0.0},"28":{"x":1447200000000,"y":639.0},"29":{"x":1447545600000,"y":1161.6},"30":{"x":1447718400000,"y":5111.0},"31":{"x":1447977600000,"y":5496.6},"32":{"x":1448064000000,"y":1582.8},"33":{"x":1449100800000,"y":906.8},"34":{"x":1449619200000,"y":496.6},"35":{"x":1449705600000,"y":3341.8},"36":{"x":1449878400000,"y":4871.0},"37":{"x":1449964800000,"y":4119.8},"38":{"x":1450137600000,"y":3852.2},"39":{"x":1450483200000,"y":1580.2},"40":{"x":1450569600000,"y":1343.0},"41":{"x":1452297600000,"y":3054.6}};

*/
{% block content %}
var recovery = JSON.parse('{{ recovery_json | escapejs }}');
var easy = JSON.parse('{{ easy_json | escapejs }}');
var stamina = JSON.parse('{{ stamina_json | escapejs }}');
var impulse = JSON.parse('{{ impulse_json | escapejs }}');


var rec = new Array();
var ea = new Array();
var stam = new Array();
var imp = new Array();

for (key in recovery) { rec.push(recovery[key]) };
for (key in easy) { ea.push(easy[key]) };
for (key in stamina) { stam.push(stamina[key]) };
for (key in impulse) { imp.push(impulse[key]) };

rawData = new Array(rec, ea, stam, imp);

var n = rawData.length, // number of layers
    m = rawData[0].length, // number of samples per layer
    stack = d3.layout.stack(),
    layers = stack(rawData),
    yGroupMax = d3.max(layers, function(layer) { return d3.max(layer, function(d) { return d.y; }); }),
    yStackMax = d3.max(layers, function(layer) { return d3.max(layer, function(d) { return d.y0 + d.y; }); });

var margin = {top: 20, right: 10, bottom: 20, left: 10},
    width = 960 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

var jsDay = 86400000;    //Each day is 86400 seconds
var now = Date.now();

mExtent = [(now-jsDay*30),now];

oExtent = [
    d3.min(layers, function(layer) { return d3.min(layer, function(d) { return d.x; }) - jsDay; }),
    now + jsDay 
    ];

var x = d3.time.scale()  // x scale
    .domain(oExtent)
    .range([margin.left, width]);

var y = d3.scale.linear()   // y scale
    .domain([0, yStackMax])
    .range([height, 0]);
 
/// creating main svg
var svg = d3.select("#bars").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
    
var barStacked = true; // boolean to help w stacked vs grouped state of bars

var color = d3.scale.linear()  // color scale
    .domain([3,2,1,0])
    .range(["#d7191c","#fdae61","#a6d96a","#1a9641"]);

/////////////////////////////////////////////////////////     
// adding brush

var brush = d3.svg.brush()
    .x(x)
    .on("brush", brushmove)
    .on("brushend", redrawChart);
    
function brushmove() {
    var extent = brush.extent();
    };

function getY() {
    if (barStacked) {
        return function(d) { return y(d.y0 + d.y); } }
    else { return function(d) { return y(d.y); } }   };

function getX() {
    if (barStacked) {
        return function(d) { return x(d.x); } }
    else { return function(d, i, j) { return x(d.x) + barWidth / n * j; } }  };

function getW() {
    if (barStacked) {
        return barWidth }
    else { return barWidth / n }  };
    
function getBarW() {
    var xDom = extent[1] - extent[0]; // calculating bar width
    var jsDay = 86400000;
    var days = xDom / jsDay;
    bwt = width / days;
    barWidth = bwt - 3;
    return barWidth }

function redrawChart() {          // drawing up new graphs
    extent = brush.extent();
    if (extent[1] - extent[0] > 86400000) {  // only brushing when brush width exceeds one-day 
    
        svg.selectAll("rect")
            .classed("kill", function (d) {
            if (extent[0] >= d.x || d.x >= extent[1]) {return true}
            });
        
        x.domain(extent); // updating domain to reflect brush 
               
        barWidth = getBarW()     
           
        layer.selectAll("rect")
        .data(function(d) { return d; })
        .transition()
        .duration(300)
        .attr("x", getX())
        .attr("y", getY())   
        .attr("width", getW());  
           
        svg.select('.x.axis')
        .call(xAxis);    
        
        // updating rolling chart
        var area = d3.svg.area()
            .x(function(d) { return x(d.x); })
            .y0(function(d) { return yR(d.y0); })
            .y1(function(d) { return yR(d.y0 + d.y); });     
        
        svg2.selectAll("path")
            .data(layers0)
            .transition()
            .duration(300)
            .attr("d", area)
            .style("fill", function(d, i) { return color(i); });
        
        }// everything above is within "if" statement
        
    d3.selectAll(".brush")      // clearing brush from all graphs
      .call(brush.clear());   
};

svg.append("g")                 // adding brush to svg
    .attr("class", "brush")
    .call(brush)
    .selectAll("rect")
    .attr("height", height)
    .style("opacity", .1);

    
d3.select("#reset")             // Resetting to original view
    .on("click", function() {  
        brush.extent(oExtent);  // FINALLY IT WORKS       
        svg.select('.brush')
        .call(brush);      
        redrawChart();
    } );  
   
var goMonth = function() {  
        brush.extent(mExtent);        
        svg.select('.brush')
        .call(brush);     
        redrawChart();  }   
    
d3.select("#month")             // setting to month
    .on("click", goMonth);     

// calculating bar widths       
var threemExtent = [now-jsDay*30*3, now];          
var xMax = now;
var xMin = oExtent[0];   // change this when changing initial zoom
var xDom = xMax - xMin
var days = xDom / jsDay;
var bwt = width / days;
var barWidth = bwt-3; 

/*
x.domain(threemExtent);   // initializing with zoom at one month
redrawChart(); 
*/

//////////////////////////////////////////////////
/// creating axes
var xAxis = d3.svg.axis()
    .scale(x)
    .tickSize(0)
    .tickPadding(6)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .innerTickSize(-width)
    .outerTickSize(0)
    .tickPadding(10)
    .orient("left");
    
//// Appending axes
svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .attr("transform", "translate(10,0)")
    .call(yAxis)
  .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Miles");

/////////////////////////////////////////////////////////////////
/// appending layers etc

var layer = svg.selectAll(".layer")
    .data(layers)
  .enter().append("g")
    .attr("class", "layer")
    .style("fill", function(d, i) { return color(i); });

var rect = layer.selectAll("rect")
    .data(function(d) { return d; })
  .enter().append("rect")
    .attr("x", function(d) { return x(d.x); })
    .attr("y", height)
    .attr("width", barWidth)
    .attr("height", 0);

rect.transition()   // initial transition into place
    .delay(function(d, i) { return i * 10; })
    .attr("y", function(d) { return y(d.y0 + d.y); })
    .attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); });

d3.selectAll("input").on("change", change); // radio buttons cued to change when pressed

function change() {
  if (this.value === "grouped") transitionGrouped() 
  else transitionStacked();
}

function transitionGrouped() {    // transition into groups
  y.domain([0, yGroupMax]);

  rect.transition()
      .duration(500)
      .delay(function(d, i) { return i * 10; })
      .attr("x", function(d, i, j) { return x(d.x) + barWidth / n * j; })
      .attr("width", barWidth / n)
    .transition()
      .attr("y", function(d) { return y(d.y); })
      .attr("height", function(d) { return height - y(d.y); });
      
   barStacked = !barStacked;
}

function transitionStacked() {    // transition into stacks
  y.domain([0, yStackMax]);

  rect.transition()
      .duration(500)
      .delay(function(d, i) { return i * 10; })
      .attr("y", function(d) { return y(d.y0 + d.y); })
      .attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); })
    .transition()
      .attr("x", function(d) { return x(d.x); })
      .attr("width", barWidth);
      
  barStacked = !barStacked;
}

/////////////////////////////////////////////////////
// tooltip for zone rects
// 
svg.selectAll("rect")
    .on("mouseover", function(d) {
        thisTime = d.x
        svg.selectAll("rect")
        .filter(function(d) {
            if (d.x ==thisTime) {return true}
            })
            .classed("highlight", true);
            //.style("fill", "red");
            
            var x = d3.event.pageX;
            var y = d3.event.pageY;
            text = d.x;
            d3.select("#tooltip")
				.style("left", x + "px")
				.style("top", y + "px")
				.style("opacity", 1)
				.text(text);
            })
               
    .on("mouseout", function() {
            svg.selectAll("rect")
            .classed("highlight", false);
            //.style("fill", ptColor);
            
            d3.select("#tooltip")
                .style("opacity", 0);
         });

////////////////////////////////////////////////////////////////////////
// adding legend

var legendRectSize = 7;                                  
var legendSpacing = 4;  
var xPlacement = (width-50)
var yPlacement = 40
var legendText = ["Recovery", "Easy", "Stamina", "Impulse"]

var legend = svg.selectAll('.legend')
                .data(color.domain())
                .enter()
                .append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {
                    var vert = i*(legendRectSize + legendSpacing)+yPlacement
                    return "translate("+xPlacement+','+ vert+")";
                    });
                
legend.append('rect')                                     
      .attr('width', legendRectSize)                          
      .attr('height', legendRectSize)                         
      .style('fill', color)                                   
      .style('stroke', color);      

legend.append('text')                                     
      .attr('x', legendRectSize + legendSpacing)              
      .attr('y', legendRectSize )              
      .text(function(d) { return legendText[d]; });
      
      
      
///////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////
//
//    Rolling data
//
///////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////     
/*
var rollRecovery = 
{"0":{"x":1441497600000,"y":2582.6},"1":{"x":1441584000000,"y":2582.6},"2":{"x":1441670400000,"y":3651.0},"3":{"x":1441756800000,"y":7177.0},"4":{"x":1441843200000,"y":9121.0},"5":{"x":1441843200000,"y":9121.0},"6":{"x":1441929600000,"y":9121.0},"7":{"x":1442016000000,"y":9121.0},"8":{"x":1442102400000,"y":6638.4},"9":{"x":1442188800000,"y":8812.2},"10":{"x":1442275200000,"y":7743.8},"11":{"x":1442361600000,"y":4217.8},"12":{"x":1442448000000,"y":2273.8},"13":{"x":1442534400000,"y":5287.6},"14":{"x":1442620800000,"y":5287.6},"15":{"x":1442707200000,"y":5287.6},"16":{"x":1442793600000,"y":3113.8},"17":{"x":1442880000000,"y":3113.8},"18":{"x":1442966400000,"y":3113.8},"19":{"x":1443052800000,"y":3113.8},"20":{"x":1443139200000,"y":100.0},"21":{"x":1443225600000,"y":100.0},"22":{"x":1443312000000,"y":100.0},"23":{"x":1443398400000,"y":100.0},"24":{"x":1443484800000,"y":100.0},"25":{"x":1443571200000,"y":100.0},"26":{"x":1443657600000,"y":100.0},"27":{"x":1443744000000,"y":100.0},"28":{"x":1443830400000,"y":100.0},"29":{"x":1443916800000,"y":100.0},"30":{"x":1444003200000,"y":981.2},"31":{"x":1444089600000,"y":981.2},"32":{"x":1444176000000,"y":1725.0},"33":{"x":1444262400000,"y":3068.4},"34":{"x":1444348800000,"y":3068.4},"35":{"x":1444435200000,"y":3068.4},"36":{"x":1444521600000,"y":5588.0},"37":{"x":1444608000000,"y":5578.6},"38":{"x":1444694400000,"y":5578.6},"39":{"x":1444780800000,"y":4834.8},"40":{"x":1444867200000,"y":3491.4},"41":{"x":1444953600000,"y":6583.8},"42":{"x":1445040000000,"y":10219.4},"43":{"x":1445126400000,"y":7699.8},"44":{"x":1445212800000,"y":9290.2},"45":{"x":1445299200000,"y":9290.2},"46":{"x":1445385600000,"y":9290.2},"47":{"x":1445472000000,"y":11008.2},"48":{"x":1445558400000,"y":15214.2},"49":{"x":1445644800000,"y":11578.6},"50":{"x":1445731200000,"y":15733.2},"51":{"x":1445817600000,"y":14599.0},"52":{"x":1445904000000,"y":14599.0},"53":{"x":1445990400000,"y":14599.0},"54":{"x":1446076800000,"y":12881.0},"55":{"x":1446163200000,"y":5582.6},"56":{"x":1446249600000,"y":7518.4},"57":{"x":1446336000000,"y":12075.4},"58":{"x":1446422400000,"y":12789.4},"59":{"x":1446422400000,"y":12789.4},"60":{"x":1446508800000,"y":12789.4},"61":{"x":1446595200000,"y":14442.0},"62":{"x":1446681600000,"y":19839.0},"63":{"x":1446768000000,"y":19839.0},"64":{"x":1446854400000,"y":17903.2},"65":{"x":1446940800000,"y":14675.6},"66":{"x":1447027200000,"y":12633.6},"67":{"x":1447113600000,"y":12633.6},"68":{"x":1447200000000,"y":15924.4},"69":{"x":1447286400000,"y":10527.4},"70":{"x":1447372800000,"y":10527.4},"71":{"x":1447459200000,"y":10527.4},"72":{"x":1447545600000,"y":8388.0},"73":{"x":1447632000000,"y":8388.0},"74":{"x":1447718400000,"y":17817.8},"75":{"x":1447804800000,"y":12874.4},"76":{"x":1447891200000,"y":12874.4},"77":{"x":1447977600000,"y":16234.6},"78":{"x":1448064000000,"y":18324.4},"79":{"x":1448150400000,"y":14979.8},"80":{"x":1448236800000,"y":14979.8},"81":{"x":1448323200000,"y":5550.0},"82":{"x":1448409600000,"y":5550.0},"83":{"x":1448496000000,"y":5550.0},"84":{"x":1448582400000,"y":2189.8},"85":{"x":1448668800000,"y":100.0},"86":{"x":1448755200000,"y":100.0},"87":{"x":1448841600000,"y":100.0},"88":{"x":1448928000000,"y":100.0},"89":{"x":1449014400000,"y":100.0},"90":{"x":1449100800000,"y":3664.0},"91":{"x":1449187200000,"y":3664.0},"92":{"x":1449273600000,"y":3664.0},"93":{"x":1449360000000,"y":3664.0},"94":{"x":1449446400000,"y":3664.0},"95":{"x":1449532800000,"y":3664.0},"96":{"x":1449619200000,"y":6842.2},"97":{"x":1449705600000,"y":7107.0},"98":{"x":1449792000000,"y":7107.0},"99":{"x":1449878400000,"y":8923.2},"100":{"x":1449964800000,"y":9201.0},"101":{"x":1450051200000,"y":9201.0},"102":{"x":1450137600000,"y":11760.8},"103":{"x":1450224000000,"y":8582.6},"104":{"x":1450310400000,"y":4753.8},"105":{"x":1450396800000,"y":4753.8},"106":{"x":1450483200000,"y":7256.6},"107":{"x":1450569600000,"y":11685.6},"108":{"x":1450656000000,"y":11685.6},"109":{"x":1450742400000,"y":9125.8},"110":{"x":1450828800000,"y":9125.8},"111":{"x":1450915200000,"y":9125.8},"112":{"x":1451001600000,"y":9125.8},"113":{"x":1451088000000,"y":4806.8},"114":{"x":1451174400000,"y":100.0},"115":{"x":1451260800000,"y":100.0},"116":{"x":1451347200000,"y":100.0},"117":{"x":1451433600000,"y":100.0},"118":{"x":1451520000000,"y":100.0},"119":{"x":1451606400000,"y":100.0},"120":{"x":1451692800000,"y":100.0},"121":{"x":1451779200000,"y":100.0},"122":{"x":1451865600000,"y":100.0},"123":{"x":1451952000000,"y":100.0},"124":{"x":1452038400000,"y":100.0},"125":{"x":1452124800000,"y":100.0},"126":{"x":1452211200000,"y":100.0},"127":{"x":1452297600000,"y":3321.8},"128":{"x":1452384000000,"y":3321.8},"129":{"x":1452470400000,"y":3321.8},"130":{"x":1452556800000,"y":3321.8},"131":{"x":1452643200000,"y":3321.8},"132":{"x":1452729600000,"y":3321.8},"133":{"x":1452816000000,"y":3321.8},"134":{"x":1452902400000,"y":100.0},"135":{"x":1452988800000,"y":100.0},"136":{"x":1453075200000,"y":100.0},"137":{"x":1453161600000,"y":100.0},"138":{"x":1453248000000,"y":100.0},"139":{"x":1453334400000,"y":100.0},"140":{"x":1453420800000,"y":100.0},"141":{"x":1453507200000,"y":100.0},"142":{"x":1453593600000,"y":100.0},"143":{"x":1453680000000,"y":100.0},"144":{"x":1453766400000,"y":100.0},"145":{"x":1453852800000,"y":100.0},"146":{"x":1453939200000,"y":100.0},"147":{"x":1454025600000,"y":100.0},"148":{"x":1454112000000,"y":100.0},"149":{"x":1454198400000,"y":100.0},"150":{"x":1454284800000,"y":100.0},"151":{"x":1454371200000,"y":100.0},"152":{"x":1454457600000,"y":100.0},"153":{"x":1454544000000,"y":100.0},"154":{"x":1454630400000,"y":100.0},"155":{"x":1454716800000,"y":100.0},"156":{"x":1454803200000,"y":100.0}};

var rollEasy = 
{"0":{"x":1441497600000,"y":17694.4},"1":{"x":1441584000000,"y":17694.4},"2":{"x":1441670400000,"y":25290.8},"3":{"x":1441756800000,"y":54445.2},"4":{"x":1441843200000,"y":62132.0},"5":{"x":1441843200000,"y":62132.0},"6":{"x":1441929600000,"y":62132.0},"7":{"x":1442016000000,"y":62132.0},"8":{"x":1442102400000,"y":44437.6},"9":{"x":1442188800000,"y":69315.1999999999},"10":{"x":1442275200000,"y":61718.7999999999},"11":{"x":1442361600000,"y":32564.3999999999},"12":{"x":1442448000000,"y":24877.5999999999},"13":{"x":1442534400000,"y":36853.7999999999},"14":{"x":1442620800000,"y":36853.7999999999},"15":{"x":1442707200000,"y":36853.7999999999},"16":{"x":1442793600000,"y":11976.2},"17":{"x":1442880000000,"y":11976.2},"18":{"x":1442966400000,"y":11976.2},"19":{"x":1443052800000,"y":11976.2},"20":{"x":1443139200000,"y":0.0},"21":{"x":1443225600000,"y":0.0},"22":{"x":1443312000000,"y":0.0},"23":{"x":1443398400000,"y":0.0},"24":{"x":1443484800000,"y":0.0},"25":{"x":1443571200000,"y":0.0},"26":{"x":1443657600000,"y":0.0},"27":{"x":1443744000000,"y":0.0},"28":{"x":1443830400000,"y":0.0},"29":{"x":1443916800000,"y":0.0},"30":{"x":1444003200000,"y":1430.2},"31":{"x":1444089600000,"y":1430.2},"32":{"x":1444176000000,"y":3559.6},"33":{"x":1444262400000,"y":9119.6},"34":{"x":1444348800000,"y":9119.6},"35":{"x":1444435200000,"y":9119.6},"36":{"x":1444521600000,"y":12793.2},"37":{"x":1444608000000,"y":18489.0},"38":{"x":1444694400000,"y":18489.0},"39":{"x":1444780800000,"y":16359.6},"40":{"x":1444867200000,"y":10799.6},"41":{"x":1444953600000,"y":15096.2},"42":{"x":1445040000000,"y":18814.8},"43":{"x":1445126400000,"y":15141.2},"44":{"x":1445212800000,"y":13009.4},"45":{"x":1445299200000,"y":13009.4},"46":{"x":1445385600000,"y":13009.4},"47":{"x":1445472000000,"y":25274.4},"48":{"x":1445558400000,"y":32825.8},"49":{"x":1445644800000,"y":29107.2},"50":{"x":1445731200000,"y":31509.0},"51":{"x":1445817600000,"y":32313.2},"52":{"x":1445904000000,"y":32313.2},"53":{"x":1445990400000,"y":32313.2},"54":{"x":1446076800000,"y":20048.2},"55":{"x":1446163200000,"y":8200.2},"56":{"x":1446249600000,"y":16700.0},"57":{"x":1446336000000,"y":21338.4},"58":{"x":1446422400000,"y":29337.0},"59":{"x":1446422400000,"y":29337.0},"60":{"x":1446508800000,"y":29337.0},"61":{"x":1446595200000,"y":46576.8},"62":{"x":1446681600000,"y":57972.4},"63":{"x":1446768000000,"y":57972.4},"64":{"x":1446854400000,"y":49472.6},"65":{"x":1446940800000,"y":52190.8},"66":{"x":1447027200000,"y":38393.8},"67":{"x":1447113600000,"y":38393.8},"68":{"x":1447200000000,"y":31722.6},"69":{"x":1447286400000,"y":20327.0},"70":{"x":1447372800000,"y":20327.0},"71":{"x":1447459200000,"y":20327.0},"72":{"x":1447545600000,"y":20332.2},"73":{"x":1447632000000,"y":20332.2},"74":{"x":1447718400000,"y":24768.4},"75":{"x":1447804800000,"y":14199.8},"76":{"x":1447891200000,"y":14199.8},"77":{"x":1447977600000,"y":21192.8},"78":{"x":1448064000000,"y":33514.4},"79":{"x":1448150400000,"y":23750.8},"80":{"x":1448236800000,"y":23750.8},"81":{"x":1448323200000,"y":19314.6},"82":{"x":1448409600000,"y":19314.6},"83":{"x":1448496000000,"y":19314.6},"84":{"x":1448582400000,"y":12321.6},"85":{"x":1448668800000,"y":0.0},"86":{"x":1448755200000,"y":0.0},"87":{"x":1448841600000,"y":0.0},"88":{"x":1448928000000,"y":0.0},"89":{"x":1449014400000,"y":0.0},"90":{"x":1449100800000,"y":5621.6},"91":{"x":1449187200000,"y":5621.6},"92":{"x":1449273600000,"y":5621.6},"93":{"x":1449360000000,"y":5621.6},"94":{"x":1449446400000,"y":5621.6},"95":{"x":1449532800000,"y":5621.6},"96":{"x":1449619200000,"y":18804.6},"97":{"x":1449705600000,"y":21216.2},"98":{"x":1449792000000,"y":21216.2},"99":{"x":1449878400000,"y":29885.8},"100":{"x":1449964800000,"y":30843.4},"101":{"x":1450051200000,"y":30843.4},"102":{"x":1450137600000,"y":39130.2},"103":{"x":1450224000000,"y":25947.2},"104":{"x":1450310400000,"y":17914.0},"105":{"x":1450396800000,"y":17914.0},"106":{"x":1450483200000,"y":25350.0},"107":{"x":1450569600000,"y":31670.0},"108":{"x":1450656000000,"y":31670.0},"109":{"x":1450742400000,"y":23383.2},"110":{"x":1450828800000,"y":23383.2},"111":{"x":1450915200000,"y":23383.2},"112":{"x":1451001600000,"y":23383.2},"113":{"x":1451088000000,"y":7277.6},"114":{"x":1451174400000,"y":0.0},"115":{"x":1451260800000,"y":0.0},"116":{"x":1451347200000,"y":0.0},"117":{"x":1451433600000,"y":0.0},"118":{"x":1451520000000,"y":0.0},"119":{"x":1451606400000,"y":0.0},"120":{"x":1451692800000,"y":0.0},"121":{"x":1451779200000,"y":0.0},"122":{"x":1451865600000,"y":0.0},"123":{"x":1451952000000,"y":0.0},"124":{"x":1452038400000,"y":0.0},"125":{"x":1452124800000,"y":0.0},"126":{"x":1452211200000,"y":0.0},"127":{"x":1452297600000,"y":13768.2},"128":{"x":1452384000000,"y":13768.2},"129":{"x":1452470400000,"y":13768.2},"130":{"x":1452556800000,"y":13768.2},"131":{"x":1452643200000,"y":13768.2},"132":{"x":1452729600000,"y":13768.2},"133":{"x":1452816000000,"y":13768.2},"134":{"x":1452902400000,"y":0.0},"135":{"x":1452988800000,"y":0.0},"136":{"x":1453075200000,"y":0.0},"137":{"x":1453161600000,"y":0.0},"138":{"x":1453248000000,"y":0.0},"139":{"x":1453334400000,"y":0.0},"140":{"x":1453420800000,"y":0.0},"141":{"x":1453507200000,"y":0.0},"142":{"x":1453593600000,"y":0.0},"143":{"x":1453680000000,"y":0.0},"144":{"x":1453766400000,"y":0.0},"145":{"x":1453852800000,"y":0.0},"146":{"x":1453939200000,"y":0.0},"147":{"x":1454025600000,"y":0.0},"148":{"x":1454112000000,"y":0.0},"149":{"x":1454198400000,"y":0.0},"150":{"x":1454284800000,"y":0.0},"151":{"x":1454371200000,"y":0.0},"152":{"x":1454457600000,"y":0.0},"153":{"x":1454544000000,"y":0.0},"154":{"x":1454630400000,"y":0.0},"155":{"x":1454716800000,"y":0.0},"156":{"x":1454803200000,"y":0.0}};

var rollStamina =
{"0":{"x":1441497600000,"y":16486.2},"1":{"x":1441584000000,"y":16486.2},"2":{"x":1441670400000,"y":24352.4},"3":{"x":1441756800000,"y":32599.6},"4":{"x":1441843200000,"y":37347.0},"5":{"x":1441843200000,"y":37347.0},"6":{"x":1441929600000,"y":37347.0},"7":{"x":1442016000000,"y":37347.0},"8":{"x":1442102400000,"y":20860.8},"9":{"x":1442188800000,"y":28248.0},"10":{"x":1442275200000,"y":20381.8},"11":{"x":1442361600000,"y":12134.6},"12":{"x":1442448000000,"y":7387.2},"13":{"x":1442534400000,"y":27278.0000000001},"14":{"x":1442620800000,"y":27278.0000000001},"15":{"x":1442707200000,"y":27278.0000000001},"16":{"x":1442793600000,"y":19890.8000000001},"17":{"x":1442880000000,"y":19890.8000000001},"18":{"x":1442966400000,"y":19890.8000000001},"19":{"x":1443052800000,"y":19890.8000000001},"20":{"x":1443139200000,"y":0.0},"21":{"x":1443225600000,"y":0.0},"22":{"x":1443312000000,"y":0.0},"23":{"x":1443398400000,"y":0.0},"24":{"x":1443484800000,"y":0.0},"25":{"x":1443571200000,"y":0.0},"26":{"x":1443657600000,"y":0.0},"27":{"x":1443744000000,"y":0.0},"28":{"x":1443830400000,"y":0.0},"29":{"x":1443916800000,"y":0.0},"30":{"x":1444003200000,"y":13546.2},"31":{"x":1444089600000,"y":13546.2},"32":{"x":1444176000000,"y":20620.6},"33":{"x":1444262400000,"y":34214.0},"34":{"x":1444348800000,"y":34214.0},"35":{"x":1444435200000,"y":34214.0},"36":{"x":1444521600000,"y":45974.8},"37":{"x":1444608000000,"y":36370.6},"38":{"x":1444694400000,"y":36370.6},"39":{"x":1444780800000,"y":29296.2},"40":{"x":1444867200000,"y":15702.8},"41":{"x":1444953600000,"y":30760.4},"42":{"x":1445040000000,"y":33314.8},"43":{"x":1445126400000,"y":21554.0},"44":{"x":1445212800000,"y":27730.6},"45":{"x":1445299200000,"y":27730.6},"46":{"x":1445385600000,"y":27730.6},"47":{"x":1445472000000,"y":35822.0},"48":{"x":1445558400000,"y":29244.2},"49":{"x":1445644800000,"y":26689.8},"50":{"x":1445731200000,"y":30455.4},"51":{"x":1445817600000,"y":35875.4},"52":{"x":1445904000000,"y":35875.4},"53":{"x":1445990400000,"y":35875.4},"54":{"x":1446076800000,"y":27784.0},"55":{"x":1446163200000,"y":19304.2},"56":{"x":1446249600000,"y":25786.0},"57":{"x":1446336000000,"y":22947.4},"58":{"x":1446422400000,"y":14875.4},"59":{"x":1446422400000,"y":14875.4},"60":{"x":1446508800000,"y":14875.4},"61":{"x":1446595200000,"y":19303.2},"62":{"x":1446681600000,"y":26369.6},"63":{"x":1446768000000,"y":26369.6},"64":{"x":1446854400000,"y":19887.8},"65":{"x":1446940800000,"y":22129.8},"66":{"x":1447027200000,"y":14663.2},"67":{"x":1447113600000,"y":14663.2},"68":{"x":1447200000000,"y":16406.2},"69":{"x":1447286400000,"y":9339.8},"70":{"x":1447372800000,"y":9339.8},"71":{"x":1447459200000,"y":9339.8},"72":{"x":1447545600000,"y":14705.0},"73":{"x":1447632000000,"y":14705.0},"74":{"x":1447718400000,"y":21134.4},"75":{"x":1447804800000,"y":14963.6},"76":{"x":1447891200000,"y":14963.6},"77":{"x":1447977600000,"y":22745.6},"78":{"x":1448064000000,"y":27148.0},"79":{"x":1448150400000,"y":18613.8},"80":{"x":1448236800000,"y":18613.8},"81":{"x":1448323200000,"y":12184.4},"82":{"x":1448409600000,"y":12184.4},"83":{"x":1448496000000,"y":12184.4},"84":{"x":1448582400000,"y":4402.4},"85":{"x":1448668800000,"y":0.0},"86":{"x":1448755200000,"y":0.0},"87":{"x":1448841600000,"y":0.0},"88":{"x":1448928000000,"y":0.0},"89":{"x":1449014400000,"y":0.0},"90":{"x":1449100800000,"y":12544.8},"91":{"x":1449187200000,"y":12544.8},"92":{"x":1449273600000,"y":12544.8},"93":{"x":1449360000000,"y":12544.8},"94":{"x":1449446400000,"y":12544.8},"95":{"x":1449532800000,"y":12544.8},"96":{"x":1449619200000,"y":18038.6},"97":{"x":1449705600000,"y":8586.4},"98":{"x":1449792000000,"y":8586.4},"99":{"x":1449878400000,"y":16603.2},"100":{"x":1449964800000,"y":18113.8},"101":{"x":1450051200000,"y":18113.8},"102":{"x":1450137600000,"y":26189.4},"103":{"x":1450224000000,"y":20695.6},"104":{"x":1450310400000,"y":17603.0},"105":{"x":1450396800000,"y":17603.0},"106":{"x":1450483200000,"y":11254.6},"107":{"x":1450569600000,"y":10188.8},"108":{"x":1450656000000,"y":10188.8},"109":{"x":1450742400000,"y":2113.2},"110":{"x":1450828800000,"y":2113.2},"111":{"x":1450915200000,"y":2113.2},"112":{"x":1451001600000,"y":2113.2},"113":{"x":1451088000000,"y":444.8},"114":{"x":1451174400000,"y":0.0},"115":{"x":1451260800000,"y":0.0},"116":{"x":1451347200000,"y":0.0},"117":{"x":1451433600000,"y":0.0},"118":{"x":1451520000000,"y":0.0},"119":{"x":1451606400000,"y":0.0},"120":{"x":1451692800000,"y":0.0},"121":{"x":1451779200000,"y":0.0},"122":{"x":1451865600000,"y":0.0},"123":{"x":1451952000000,"y":0.0},"124":{"x":1452038400000,"y":0.0},"125":{"x":1452124800000,"y":0.0},"126":{"x":1452211200000,"y":0.0},"127":{"x":1452297600000,"y":2864.2},"128":{"x":1452384000000,"y":2864.2},"129":{"x":1452470400000,"y":2864.2},"130":{"x":1452556800000,"y":2864.2},"131":{"x":1452643200000,"y":2864.2},"132":{"x":1452729600000,"y":2864.2},"133":{"x":1452816000000,"y":2864.2},"134":{"x":1452902400000,"y":0.0},"135":{"x":1452988800000,"y":0.0},"136":{"x":1453075200000,"y":0.0},"137":{"x":1453161600000,"y":0.0},"138":{"x":1453248000000,"y":0.0},"139":{"x":1453334400000,"y":0.0},"140":{"x":1453420800000,"y":0.0},"141":{"x":1453507200000,"y":0.0},"142":{"x":1453593600000,"y":0.0},"143":{"x":1453680000000,"y":0.0},"144":{"x":1453766400000,"y":0.0},"145":{"x":1453852800000,"y":0.0},"146":{"x":1453939200000,"y":0.0},"147":{"x":1454025600000,"y":0.0},"148":{"x":1454112000000,"y":0.0},"149":{"x":1454198400000,"y":0.0},"150":{"x":1454284800000,"y":0.0},"151":{"x":1454371200000,"y":0.0},"152":{"x":1454457600000,"y":0.0},"153":{"x":1454544000000,"y":0.0},"154":{"x":1454630400000,"y":0.0},"155":{"x":1454716800000,"y":0.0},"156":{"x":1454803200000,"y":0.0}};

var rollImpulse = 
{"0":{"x":1441497600000,"y":2174.0},"1":{"x":1441584000000,"y":2174.0},"2":{"x":1441670400000,"y":8227.6},"3":{"x":1441756800000,"y":8992.0},"4":{"x":1441843200000,"y":12770.4},"5":{"x":1441843200000,"y":12770.4},"6":{"x":1441929600000,"y":12770.4},"7":{"x":1442016000000,"y":12770.4},"8":{"x":1442102400000,"y":10596.4},"9":{"x":1442188800000,"y":10962.0},"10":{"x":1442275200000,"y":4908.4},"11":{"x":1442361600000,"y":4144.0},"12":{"x":1442448000000,"y":365.6},"13":{"x":1442534400000,"y":6731.6},"14":{"x":1442620800000,"y":6731.6},"15":{"x":1442707200000,"y":6731.6},"16":{"x":1442793600000,"y":6366.0},"17":{"x":1442880000000,"y":6366.0},"18":{"x":1442966400000,"y":6366.0},"19":{"x":1443052800000,"y":6366.0},"20":{"x":1443139200000,"y":0.0},"21":{"x":1443225600000,"y":0.0},"22":{"x":1443312000000,"y":0.0},"23":{"x":1443398400000,"y":0.0},"24":{"x":1443484800000,"y":0.0},"25":{"x":1443571200000,"y":0.0},"26":{"x":1443657600000,"y":0.0},"27":{"x":1443744000000,"y":0.0},"28":{"x":1443830400000,"y":0.0},"29":{"x":1443916800000,"y":0.0},"30":{"x":1444003200000,"y":7978.8},"31":{"x":1444089600000,"y":7978.8},"32":{"x":1444176000000,"y":15974.0},"33":{"x":1444262400000,"y":18696.6},"34":{"x":1444348800000,"y":18696.6},"35":{"x":1444435200000,"y":18696.6},"36":{"x":1444521600000,"y":23907.4},"37":{"x":1444608000000,"y":15998.2},"38":{"x":1444694400000,"y":15998.2},"39":{"x":1444780800000,"y":8003.0},"40":{"x":1444867200000,"y":5280.4},"41":{"x":1444953600000,"y":8588.2},"42":{"x":1445040000000,"y":13139.6},"43":{"x":1445126400000,"y":7928.8},"44":{"x":1445212800000,"y":19000.8},"45":{"x":1445299200000,"y":19000.8},"46":{"x":1445385600000,"y":19000.8},"47":{"x":1445472000000,"y":19247.4},"48":{"x":1445558400000,"y":16031.8},"49":{"x":1445644800000,"y":11480.4},"50":{"x":1445731200000,"y":21491.4},"51":{"x":1445817600000,"y":10574.6},"52":{"x":1445904000000,"y":10574.6},"53":{"x":1445990400000,"y":10574.6},"54":{"x":1446076800000,"y":10328.0},"55":{"x":1446163200000,"y":10235.8},"56":{"x":1446249600000,"y":14396.8},"57":{"x":1446336000000,"y":4385.8},"58":{"x":1446422400000,"y":9031.0},"59":{"x":1446422400000,"y":9031.0},"60":{"x":1446508800000,"y":9031.0},"61":{"x":1446595200000,"y":9031.0},"62":{"x":1446681600000,"y":13133.4},"63":{"x":1446768000000,"y":13133.4},"64":{"x":1446854400000,"y":8972.4},"65":{"x":1446940800000,"y":8972.4},"66":{"x":1447027200000,"y":4102.4},"67":{"x":1447113600000,"y":4102.4},"68":{"x":1447200000000,"y":4741.4},"69":{"x":1447286400000,"y":639.0},"70":{"x":1447372800000,"y":639.0},"71":{"x":1447459200000,"y":639.0},"72":{"x":1447545600000,"y":1800.6},"73":{"x":1447632000000,"y":1800.6},"74":{"x":1447718400000,"y":6911.6},"75":{"x":1447804800000,"y":6272.6},"76":{"x":1447891200000,"y":6272.6},"77":{"x":1447977600000,"y":11769.2},"78":{"x":1448064000000,"y":13352.0},"79":{"x":1448150400000,"y":12190.4},"80":{"x":1448236800000,"y":12190.4},"81":{"x":1448323200000,"y":7079.4},"82":{"x":1448409600000,"y":7079.4},"83":{"x":1448496000000,"y":7079.4},"84":{"x":1448582400000,"y":1582.8},"85":{"x":1448668800000,"y":0.0},"86":{"x":1448755200000,"y":0.0},"87":{"x":1448841600000,"y":0.0},"88":{"x":1448928000000,"y":0.0},"89":{"x":1449014400000,"y":0.0},"90":{"x":1449100800000,"y":906.8},"91":{"x":1449187200000,"y":906.8},"92":{"x":1449273600000,"y":906.8},"93":{"x":1449360000000,"y":906.8},"94":{"x":1449446400000,"y":906.8},"95":{"x":1449532800000,"y":906.8},"96":{"x":1449619200000,"y":1403.4},"97":{"x":1449705600000,"y":3838.4},"98":{"x":1449792000000,"y":3838.4},"99":{"x":1449878400000,"y":8709.4},"100":{"x":1449964800000,"y":12829.2},"101":{"x":1450051200000,"y":12829.2},"102":{"x":1450137600000,"y":16681.4},"103":{"x":1450224000000,"y":16184.8},"104":{"x":1450310400000,"y":12843.0},"105":{"x":1450396800000,"y":12843.0},"106":{"x":1450483200000,"y":9552.2},"107":{"x":1450569600000,"y":6775.4},"108":{"x":1450656000000,"y":6775.4},"109":{"x":1450742400000,"y":2923.2},"110":{"x":1450828800000,"y":2923.2},"111":{"x":1450915200000,"y":2923.2},"112":{"x":1451001600000,"y":2923.2},"113":{"x":1451088000000,"y":1343.0},"114":{"x":1451174400000,"y":0.0},"115":{"x":1451260800000,"y":0.0},"116":{"x":1451347200000,"y":0.0},"117":{"x":1451433600000,"y":0.0},"118":{"x":1451520000000,"y":0.0},"119":{"x":1451606400000,"y":0.0},"120":{"x":1451692800000,"y":0.0},"121":{"x":1451779200000,"y":0.0},"122":{"x":1451865600000,"y":0.0},"123":{"x":1451952000000,"y":0.0},"124":{"x":1452038400000,"y":0.0},"125":{"x":1452124800000,"y":0.0},"126":{"x":1452211200000,"y":0.0},"127":{"x":1452297600000,"y":3054.6},"128":{"x":1452384000000,"y":3054.6},"129":{"x":1452470400000,"y":3054.6},"130":{"x":1452556800000,"y":3054.6},"131":{"x":1452643200000,"y":3054.6},"132":{"x":1452729600000,"y":3054.6},"133":{"x":1452816000000,"y":3054.6},"134":{"x":1452902400000,"y":0.0},"135":{"x":1452988800000,"y":0.0},"136":{"x":1453075200000,"y":0.0},"137":{"x":1453161600000,"y":0.0},"138":{"x":1453248000000,"y":0.0},"139":{"x":1453334400000,"y":0.0},"140":{"x":1453420800000,"y":0.0},"141":{"x":1453507200000,"y":0.0},"142":{"x":1453593600000,"y":0.0},"143":{"x":1453680000000,"y":0.0},"144":{"x":1453766400000,"y":0.0},"145":{"x":1453852800000,"y":0.0},"146":{"x":1453939200000,"y":0.0},"147":{"x":1454025600000,"y":0.0},"148":{"x":1454112000000,"y":0.0},"149":{"x":1454198400000,"y":0.0},"150":{"x":1454284800000,"y":0.0},"151":{"x":1454371200000,"y":0.0},"152":{"x":1454457600000,"y":0.0},"153":{"x":1454544000000,"y":0.0},"154":{"x":1454630400000,"y":0.0},"155":{"x":1454716800000,"y":0.0},"156":{"x":1454803200000,"y":0.0}};
*/

var rollRecovery = JSON.parse('{{ rollRec_json | escapejs }}');
var rollEasy = JSON.parse('{{ rollEasy_json | escapejs }}');
var rollStamina = JSON.parse('{{ rollStam_json | escapejs }}');
var rollImpulse = JSON.parse('{{ rollImp_json | escapejs }}');


var rollRec = new Array();
var rollEa = new Array();
var rollStam = new Array();
var rollImp = new Array();

for (key in rollRecovery) { rollRec.push(rollRecovery[key]) };
for (key in rollEasy) { rollEa.push(rollEasy[key]) };
for (key in rollStamina) { rollStam.push(rollStamina[key]) };
for (key in rollImpulse) { rollImp.push(rollImpulse[key]) };

rawData0 = new Array(rollRec, rollEa, rollStam, rollImp);

var stack0 = d3.layout.stack().offset("zero"), // silhouette or zero
    layers0 = stack0(rawData0) ;

var height0 = 80;
var width2 = width;  // change scale above to change width2

var yR = d3.scale.linear()
    .domain([0, 150000])
    .range([height0, 0]);

var svg2 = d3.select("#roll").append("svg")
    .attr("width", width2 + margin.left + margin.right)
    .attr("height", height0 + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg2.append("g")                 // adding brush to svg
    .attr("class", "brush")
    .call(brush)
    .selectAll("rect")
    .attr("height", height0)
    .style("opacity", .1);

var area = d3.svg.area()
    .interpolate("basis")
    .x(function(d) { return x(d.x); })
    .y0(function(d) { return yR(d.y0); })
    .y1(function(d) { return yR(d.y0 + d.y); }); 

svg2.selectAll("path")
    .data(layers0)
  .enter().append("path")
    .attr("d", area)
    .style("fill", function(d, i) { return color(i); });


///////////////////////////////////////////////////////////////////
//
//     calendar
//
///////////////////////////////////////////////////////////////////
/*
var runCal =    now this has activityId, as well
[{"avgHr":142.0,"climb":1431.6,"date":1441497600000,"easy":17694.4,"impulse":2174.0,"realMiles":42809.0,"recovery":2482.6,"stamina":16486.2,"totalDist":38907.0,"totalTime":11354.0,"variation":17.0},{"avgHr":149.0,"climb":574.4,"date":1441670400000,"easy":7596.4,"impulse":6053.6,"realMiles":30256.0,"recovery":1068.4,"stamina":7866.2,"totalDist":22840.8,"totalTime":6252.0,"variation":20.0},{"avgHr":135.0,"climb":1218.4,"date":1441756800000,"easy":29154.4,"impulse":764.4,"realMiles":38066.0,"recovery":3526.0,"stamina":8247.2,"totalDist":41881.0,"totalTime":12858.0,"variation":13.0},{"avgHr":91.0,"climb":2.0,"date":1441843200000,"easy":0.0,"impulse":0.0,"realMiles":12.0,"recovery":87.8,"stamina":0.0,"totalDist":211.0,"totalTime":378.0,"variation":8.0},{"avgHr":142.0,"climb":390.4,"date":1441843200000,"easy":7686.8,"impulse":3778.4,"realMiles":21549.0,"recovery":1856.2,"stamina":4747.4,"totalDist":18160.2,"totalTime":5186.0,"variation":23.0},{"avgHr":137.0,"climb":1151.8,"date":1442188800000,"easy":24877.5999999999,"impulse":365.6,"realMiles":31852.0,"recovery":2173.8,"stamina":7387.2,"totalDist":35294.7999999998,"totalTime":12432.0,"variation":12.0},{"avgHr":146.0,"climb":1351.8,"date":1442534400000,"easy":11976.2,"impulse":6366.0,"realMiles":50115.0,"recovery":3013.8,"stamina":19890.8000000001,"totalDist":41714.1999999996,"totalTime":12256.0,"variation":17.0},{"avgHr":null,"climb":0.8,"date":1442620800000,"easy":0.0,"impulse":0.0,"realMiles":null,"recovery":0.0,"stamina":0.0,"totalDist":32.6,"totalTime":1180.0,"variation":null},{"avgHr":null,"climb":44.0,"date":1442707200000,"easy":0.0,"impulse":0.0,"realMiles":null,"recovery":0.0,"stamina":0.0,"totalDist":5066.6,"totalTime":7834.0,"variation":null},{"avgHr":156.0,"climb":604.8,"date":1444003200000,"easy":1430.2,"impulse":7978.8,"realMiles":38667.0,"recovery":881.2,"stamina":13546.2,"totalDist":23836.4,"totalTime":7334.0,"variation":19.0},{"avgHr":158.0,"climb":466.0,"date":1444176000000,"easy":2129.4,"impulse":7995.2,"realMiles":30344.0,"recovery":743.8,"stamina":7074.4,"totalDist":18023.6,"totalTime":4912.0,"variation":22.0},{"avgHr":142.0,"climb":586.0,"date":1444262400000,"easy":5560.0,"impulse":2722.6,"realMiles":29535.0,"recovery":1343.4,"stamina":13593.4,"totalDist":23471.6,"totalTime":7980.0,"variation":22.0},{"avgHr":147.0,"climb":474.2,"date":1444521600000,"easy":3673.6,"impulse":5210.8,"realMiles":31787.0,"recovery":2519.6,"stamina":11760.8,"totalDist":23164.8,"totalTime":6978.0,"variation":24.0},{"avgHr":133.0,"climb":386.8,"date":1444608000000,"easy":7126.0,"impulse":69.6,"realMiles":11340.0,"recovery":871.8,"stamina":3942.0,"totalDist":12136.0,"totalTime":5902.0,"variation":17.0},{"avgHr":140.0,"climb":504.2,"date":1444953600000,"easy":4296.6,"impulse":3307.8,"realMiles":33550.0,"recovery":3092.4,"stamina":15057.6,"totalDist":26660.6,"totalTime":10412.0,"variation":26.0},{"avgHr":138.0,"climb":335.6,"date":1445040000000,"easy":3718.6,"impulse":4551.4,"realMiles":18233.0,"recovery":3635.6,"stamina":2554.4,"totalDist":14588.2,"totalTime":4932.0,"variation":30.0},{"avgHr":152.0,"climb":637.4,"date":1445212800000,"easy":4994.2,"impulse":11141.6,"realMiles":45660.0,"recovery":2462.2,"stamina":10118.6,"totalDist":28870.8,"totalTime":8936.0,"variation":26.0},{"avgHr":138.0,"climb":465.2,"date":1445472000000,"easy":12265.0,"impulse":246.6,"realMiles":21451.0,"recovery":1718.0,"stamina":8091.4,"totalDist":22454.4,"totalTime":7168.0,"variation":14.0},{"avgHr":126.0,"climb":542.2,"date":1445558400000,"easy":11848.0,"impulse":92.2,"realMiles":22573.0,"recovery":7298.4,"stamina":8479.8,"totalDist":28722.4,"totalTime":10660.0,"variation":22.0},{"avgHr":147.0,"climb":431.2,"date":1445731200000,"easy":2401.8,"impulse":10011.0,"realMiles":33481.0,"recovery":4154.6,"stamina":3765.6,"totalDist":20403.0,"totalTime":11548.0,"variation":31.0},{"avgHr":143.0,"climb":527.0,"date":1445817600000,"easy":5798.4,"impulse":224.8,"realMiles":25873.0,"recovery":1328.0,"stamina":15538.6,"totalDist":23020.0,"totalTime":6080.0,"variation":16.0},{"avgHr":143.0,"climb":328.0,"date":1446249600000,"easy":8499.8,"impulse":4161.0,"realMiles":25559.0,"recovery":1935.8,"stamina":6481.8,"totalDist":21158.2,"totalTime":7028.0,"variation":22.0},{"avgHr":110.0,"climb":467.6,"date":1446336000000,"easy":7040.2,"impulse":0.0,"realMiles":9140.0,"recovery":8711.6,"stamina":927.0,"totalDist":23305.8000000001,"totalTime":11890.0,"variation":21.0},{"avgHr":149.0,"climb":83.4,"date":1446422400000,"easy":779.6,"impulse":3105.6,"realMiles":9134.0,"recovery":851.6,"stamina":961.4,"totalDist":5698.2,"totalTime":2922.0,"variation":28.0},{"avgHr":138.0,"climb":559.8,"date":1446422400000,"easy":13017.4,"impulse":1764.4,"realMiles":23858.0,"recovery":1190.4,"stamina":6505.2,"totalDist":22706.0,"totalTime":6996.0,"variation":19.0},{"avgHr":135.0,"climb":590.6,"date":1446595200000,"easy":17239.8,"impulse":0.0,"realMiles":20697.0,"recovery":1652.6,"stamina":4427.8,"totalDist":23320.2,"totalTime":6704.0,"variation":13.0},{"avgHr":146.0,"climb":591.4,"date":1446681600000,"easy":11395.6,"impulse":4102.4,"realMiles":29313.0,"recovery":5397.0,"stamina":7066.4,"totalDist":28587.9999999998,"totalTime":25982.0,"variation":26.0},{"avgHr":122.0,"climb":209.8,"date":1446940800000,"easy":9758.4,"impulse":0.0,"realMiles":14003.0,"recovery":5484.0,"stamina":3169.0,"totalDist":18525.8,"totalTime":6898.0,"variation":21.0},{"avgHr":131.0,"climb":528.0,"date":1447200000000,"easy":10568.6,"impulse":639.0,"realMiles":20290.0,"recovery":4943.4,"stamina":6170.8,"totalDist":22712.8,"totalTime":6738.0,"variation":20.0},{"avgHr":138.0,"climb":440.8,"date":1447545600000,"easy":9763.6,"impulse":1161.6,"realMiles":23290.0,"recovery":3344.6,"stamina":8534.2,"totalDist":22926.8,"totalTime":7432.0,"variation":17.0},{"avgHr":135.0,"climb":279.4,"date":1447718400000,"easy":4436.2,"impulse":5111.0,"realMiles":28007.0,"recovery":9429.8,"stamina":6429.4,"totalDist":25419.6,"totalTime":7698.0,"variation":29.0},{"avgHr":139.0,"climb":375.8,"date":1447977600000,"easy":6993.0,"impulse":5496.6,"realMiles":29995.0,"recovery":3360.2,"stamina":7782.0,"totalDist":23672.6,"totalTime":9840.0,"variation":28.0},{"avgHr":136.0,"climb":492.8,"date":1448064000000,"easy":12321.6,"impulse":1582.8,"realMiles":20183.0,"recovery":2089.8,"stamina":4402.4,"totalDist":20396.6,"totalTime":5638.0,"variation":18.0},{"avgHr":136.0,"climb":441.0,"date":1449100800000,"easy":5621.6,"impulse":906.8,"realMiles":25271.0,"recovery":3564.0,"stamina":12544.8,"totalDist":22922.8,"totalTime":7410.0,"variation":23.0},{"avgHr":135.0,"climb":461.8,"date":1449619200000,"easy":13183.0,"impulse":496.6,"realMiles":20546.0,"recovery":3178.2,"stamina":5493.8,"totalDist":22351.6,"totalTime":6870.0,"variation":16.0},{"avgHr":138.0,"climb":503.6,"date":1449705600000,"easy":8033.2,"impulse":3341.8,"realMiles":20431.0,"recovery":3828.8,"stamina":3092.6,"totalDist":18410.6,"totalTime":5808.0,"variation":26.0},{"avgHr":145.0,"climb":622.6,"date":1449878400000,"easy":8669.6,"impulse":4871.0,"realMiles":29573.0,"recovery":1816.2,"stamina":8016.8,"totalDist":23646.4,"totalTime":7614.0,"variation":22.0},{"avgHr":152.0,"climb":94.4,"date":1449964800000,"easy":957.6,"impulse":4119.8,"realMiles":12268.0,"recovery":277.8,"stamina":1510.6,"totalDist":6865.8,"totalTime":5106.0,"variation":30.0},{"avgHr":143.0,"climb":565.8,"date":1450137600000,"easy":8286.8,"impulse":3852.2,"realMiles":27390.0,"recovery":2559.8,"stamina":8075.6,"totalDist":22774.4,"totalTime":6716.0,"variation":21.0},{"avgHr":129.0,"climb":651.6,"date":1450483200000,"easy":16105.6,"impulse":1580.2,"realMiles":20315.0,"recovery":4319.0,"stamina":1668.4,"totalDist":23700.2,"totalTime":7924.0,"variation":18.0},{"avgHr":125.0,"climb":391.6,"date":1450569600000,"easy":7277.6,"impulse":1343.0,"realMiles":11320.0,"recovery":4706.8,"stamina":444.8,"totalDist":14170.0,"totalTime":5364.0,"variation":23.0},{"avgHr":136.0,"climb":423.2,"date":1452297600000,"easy":13768.2,"impulse":3054.6,"realMiles":24076.0,"recovery":3221.8,"stamina":2864.2,"totalDist":23335.2,"totalTime":8682.0,"variation":21.0}];
*/
var runCal = JSON.parse('{{ summaryDf_json | escapejs }}');
{% endblock %}

var width3 = 960,
    height3 = 136,
    cellSize = 17; // cell size

var percent = d3.format(".1%"),
    format = d3.time.format("%Y-%m-%d");

// Year that data begins
var initYear = d3.min(runCal, function(d) {return new Date(d.date).getFullYear()}); 

var colorC = d3.scale.linear()  // color scale
    .domain([0, 50000])
    .range(['#eff3ff','#084594']);

var svg3 = d3.select("#calendar").selectAll("svg")
    .data(d3.range(initYear, 2017))
  .enter().append("svg")
    .attr("width", width3)
    .attr("height", height3)
    .attr("class", "RdYlGn")
  .append("g")
    .attr("transform", "translate(" + ((width3 - cellSize * 53) / 2) + "," + (height3 - cellSize * 7 - 1) + ")");

svg3.append("text")
    .attr("transform", "translate(-6," + cellSize * 3.5 + ")rotate(-90)")
    .style("text-anchor", "middle")
    .text(function(d) { return d; });

var rect3 = svg3.selectAll(".day")
    .data(function(d) { return d3.time.days(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
  .enter().append("rect")
    .attr("class", "day")
    .attr("width", cellSize)
    .attr("height", cellSize)
    .attr("x", function(d) { return d3.time.weekOfYear(d) * cellSize; })
    .attr("y", function(d) { return d.getDay() * cellSize; })
    .datum(format);

rect3.append("title")
    .text(function(d) { return d; });

svg3.selectAll(".month")
    .data(function(d) { return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
  .enter().append("path")
    .attr("class", "month")
    .attr("d", monthPath);

// Here begins the data-specific portion. Everything above just builds the calendar
var data3 = d3.nest()
    .key(function(d) { return format(new Date(d.date)); }) 
    .rollup(function(d) { return {'rm':d[0].realMiles, 'id':d[0].activityId}})  // values to include in nested data. 
    .map(runCal);

var haveRun = rect3.filter(function(d) { return d in data3; })

haveRun.style("fill", function(d) { return colorC(data3[d].rm); }) // value to color on
    .select("title")
      .text(function(d) { return d + ": " + data3[d].id; });

/////////////////////////////////////////////////////
// tooltip
//   

haveRun.on("mouseover", function(d) {
            thisDate = d
            rect3.filter(function(d) {
                if (d == thisDate && d in data3 ) {return true} } ) // && unnecessary now
           .style("fill", "red")                                   
           })
     .on("mouseout", function() {
             rect3.filter(function(d) { return d in data3; })
                  .style("fill", function(d) { return colorC(data3[d].rm); })
         })
     .on("click", function(d) {
            var activityId = data3[d].id
            var url = "http://127.0.0.1:8000/"
            url += activityId
            window.location = url
     });  
     
  
/*
  

svg.selectAll("rect")
    .on("mouseover", function(d) {
        thisTime = d.x
        svg.selectAll("rect")
        .filter(function(d) {
            if (d.x ==thisTime) {return true}
            })
            .classed("highlight", true);
            //.style("fill", "red");
            
            var x = d3.event.pageX;
            var y = d3.event.pageY;
            text = d.x;
            d3.select("#tooltip")
				.style("left", x + "px")
				.style("top", y + "px")
				.style("opacity", 1)
				.text(text);
            })
               
    .on("mouseout", function() {
            svg.selectAll("rect")
            .classed("highlight", false);
            //.style("fill", ptColor);
            
            d3.select("#tooltip")
                .style("opacity", 0);
         });  
  
  
    */
    
function monthPath(t0) {
  var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
      d0 = t0.getDay(), w0 = d3.time.weekOfYear(t0),
      d1 = t1.getDay(), w1 = d3.time.weekOfYear(t1);
  return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
      + "H" + w0 * cellSize + "V" + 7 * cellSize
      + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
      + "H" + (w1 + 1) * cellSize + "V" + 0
      + "H" + (w0 + 1) * cellSize + "Z";
}

d3.select(self.frameElement).style("height", "2910px");


</script>

</html>
